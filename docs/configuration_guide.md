# Configuration Guide

This document explains the various configuration files used in the Plensor system, detailing their formats, locations, and purposes for customizing system behavior and measurement logic.

---

## 🧾 Main Configuration Files

| File                      | Path                              | Purpose                        |
|---------------------------|-----------------------------------|--------------------------------|
| `measure_settings.json`   | `/home/plense/metadata/`          | Measurement queue config       |
| `app_settings.json`       | `/home/plense/`                   | Global runtime flags           |
| `message_interrupt.json`  | `/home/plense/`                   | Interrupt commands for queue   |
| `error_flag.json`         | `/home/plense/`                   | Used by watchdog               |

---

## 📦 `measure_settings.json`

Auto-generated via Streamlit (`metadata_app.py`):

```json
{
  "project_name": "Test_Session",
  "sensor_ids": [1, 2, 3],
  "use_tof": true,
  "reps_per_type": 3,
  "env_interval_s": 60,
  "signals": [
    {
      "type": "SINE",
      "start_freq": 20000,
      "stop_freq": 100000,
      "duration": 50,
      "voltage": 5,
      "damping": 0
    }
  ]
}
```
Used by `app.py` to construct the `measure` queue.

---

## 🧩 Local Metadata Files

Generated by the metadata interface and stored locally:

```
/home/plense/metadata/
```

Example metadata structure:

```json
{
  "project_name": "Test_Session",
  "session_id": "Test_01",
  "location": "Greenhouse A",
  "date": "2025-07-30",
  "sensor_ids": [1, 2, 3, 4],
  "notes": "Test session for local operation."
}
```


---

## ⚙️ `app_settings.json`

Runtime control for toggling:

```
{
"continuous_mode": true,
"force_calibration": false,
"use_metadata_json": true
}
```

Used by `app.py` at startup to control behavior.

---

## 🚨 Interrupt & Error Files

### `message_interrupt.json`

Injected mid-run to override queue or command settings:

```
{
"interrupt_type": "CALIBRATE_ALL",
"target_sensors": [1, 2]
}
```


Checked between queue cycles.

### `error_flag.json`

Created if a crash or watchdog timeout is detected. Triggers halt or restart of `app.py`.

---

## 🧪 Tips

- Always regenerate `measure_settings.json` if GUI is updated
- Keep `app_settings.json` in version control if possible
- Remove `error_flag.json` manually if stale

---

## 🔗 Related Documents

- [metadata_interface.md](metadata_interface.md)
- [measurement_app.md](measurement_app.md)
- [storage_and_logging.md](storage_and_logging.md)
- [app.py](../code/measure-plensor/artifact/app.py)
